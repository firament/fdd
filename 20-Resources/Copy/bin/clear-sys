#! /bin/bash

# 2014/04/20 22:13:40

################################################################################
#                                                                              #
# /10-Base/bin/clearsys                                                        #
#                v 0.7                                                         #
#                                                                              #
#        script to clean up old backup files and release logs                  #
#                                                                              #
#                                                                              #
#        Run before any REMASTERING or BACKUP operation                        #
#        to reduce the overhead of un-necessary files in the new image         #
#                                                                              #
#        NOTE: there will be some permission errors, yet to be fixed           #
#              ignore them for now                                             #
#                                                                              #
#        NOTE: ensure there is no trailing '/' while setting path using        #
#              CURR_PATH="/var/log"                                            #
#              else script will error out                                      #
#                                                                              #
################################################################################

# Additional Files:
# /home/sak/.config/VisualParadigm/vp.log
# /home/sak/.giteye/.metadata/.log

# # List from bleachbit
# ${HOME}/.cache/mozilla/firefox/sh1i46xq.default
# ${HOME}/.mozilla/firefox/sh1i46xq.default
# ${HOME}/.cache/thumbnails/
# ${HOME}/.cache/
# ${HOME}/.local/share/recently-used.xbel
# /tmp
# ${HOME}/.xsession-errors
# ${HOME}/.xsession-errors.old
# ${HOME}/.config/libreoffice/4/user/registrymodifications.xcu
# ${HOME}/.bash_history

# # Specific files, from bleachbit
#   /var/log/dpkg.log.1
#   /var/log/btmp.1
#   /var/log/apport.log.1
#   /var/log/alternatives.log.1
#   /var/log/syslog.1
#   /var/log/wtmp.1
#   /var/log/cups/access_log.1
#   /var/log/apport.log.2.gz
#   /var/log/syslog.2.gz
#   /var/log/installer/initial-status.gz
#   /var/log/lightdm/lightdm.log.2.gz
#   /var/log/lightdm/x-0.log.1.gz
#   /var/log/lightdm/lightdm.log.1.gz
#   /var/log/lightdm/x-0.log.2.gz
#   /var/log/apt/history.log.1.gz
#   /var/log/apt/term.log.1.gz
#   /var/log/cups/access_log.2.gz
#   /var/log/Xorg.0.log.old


CURR_PATH="use this to make subsequent commands reusable"
#------------------------------------------------------------------------------#

# run sudo command to set cred, and will not stop later
sudo echo "Cleaning up System now";

#------------------------------------------------------------------------------#
# Specific Entities
#------------------------------------------------------------------------------#

#	'AUTORUN_DONE_FLAGF' From /10-Base/bin/PlatformVars.sh
rm -fv ${HOME}/AutoRun_Complete_Success

#------------------------------------------------------------------------------#
# COMMON FOLDERs
#------------------------------------------------------------------------------#
# CURR_PATH="/APPS"
# echo "# delete backup text files generated by gedit - in COMMON FOLDERs"
# find ${CURR_PATH} -name '*~' -exec rm -v {} \;


#------------------------------------------------------------------------------#
# HOME FOLDERs
#------------------------------------------------------------------------------#

CURR_PATH=${HOME}
# echo "# delete backup text files generated by gedit - in HOME FOLDER"
# find ${CURR_PATH} -type f -name '*~' -exec rm -v {} \;

#------------------------------------------------------------------------------#
echo "# delete image caches, for space and for privacy"
CURR_PATH="${HOME}/.thumbnails/fail/gnome-thumbnail-factory"
find ${CURR_PATH} -type f -name '*' -exec rm -v {} \;

CURR_PATH="${HOME}/.thumbnails/normal"
find ${CURR_PATH} -type f -name '*' -exec rm -v {} \;

CURR_PATH="${HOME}/.thumbnails/large"
find ${CURR_PATH} -type f -name '*' -exec rm -v {} \;

# Needs to be done after installation, for image
CURR_PATH="${HOME}/.cache/mozilla/firefox/tpuk76mz.default/thumbnails"
find ${CURR_PATH} -type f -name '*' -exec rm -v {} \;

echo "# delete logs, for space"
CURR_PATH="${HOME}/.VirtualBox"
find ${CURR_PATH} -name 'VBoxSVC.log.*' -exec rm -v {} \;

CURR_PATH="${HOME}/.nbi/log/"
find ${CURR_PATH} -name '*.log' -exec rm -v {} \;

CURR_PATH="${HOME}/.nbi/log/"
find ${CURR_PATH} -name '.goutputstream-*' -exec rm -v {} \;

CURR_PATH="${HOME}/.local/share"
echo "# delete xbel backups"
ls -1A ${CURR_PATH}/recently-used.xbel.* | while read FILEs;
do
	rm -v ${FILEs};
done


# empty contents of sensitive files
echo "# clear ~/.bash_history"
cat /dev/null | tee ${HOME}/.bash_history
cat /dev/null | tee ${HOME}/.cache/sso/sso-client.log
cat /dev/null | tee ${HOME}/.cache/sso/sso-client-gui.log
cat /dev/null | tee ${HOME}/.cache/ubuntuone/log/credentials.log
cat /dev/null | tee ${HOME}/.cache/unity/migration_script.log
cat /dev/null | tee ${HOME}/.xsession-errors
cat /dev/null | tee ${HOME}/.xsession-errors.old

# reset to default content
cat > ${HOME}/.local/share/recently-used.xbel <<XBELOUT
<?xml version="1.0" encoding="UTF-8"?>
<xbel version="1.0"
      xmlns:bookmark="http://www.freedesktop.org/standards/desktop-bookmarks"
      xmlns:mime="http://www.freedesktop.org/standards/shared-mime-info"
>
</xbel>
XBELOUT

#------------------------------------------------------------------------------#
# SYSTEM FOLDERs, needs SUDO
#------------------------------------------------------------------------------#

CURR_PATH="/root/.local/share/Trash"
echo "# Cleaning Trash from ${CURR_PATH}";
sudo ls -1A ${CURR_PATH} | while read FILEs;
do
	sudo rm -v ${FILEs};
done

CURR_PATH="/home"
sudo ls -1A ${CURR_PATH} | while read HOMEs;
do
  echo "# Cleaning Trash from /home/${HOMEs}/.local/share/Trash/";
  sudo ls -1A /home/${HOMEs}/.local/share/Trash | while read TRASH;
  do
    sudo ls -1A /home/${HOMEs}/.local/share/Trash/${TRASH} | while read FILEs;
    do
	  sudo rm -v ${FILEs};
    done
  done
done

CURR_PATH="/var/log"
echo "# delete old log archives"
sudo find ${CURR_PATH} -name *.gz -exec rm -v {} \;
sudo find ${CURR_PATH} -name *.log.1 -exec rm -v {} \;
sudo find ${CURR_PATH} -name K99-windup-* -exec rm -v {} \;

# do last to clear log of this activity too
echo "# clear all current log files"
# cat /dev/null >${HOME}/.local/share/gnome-mines/history
sudo find ${CURR_PATH} -name *.log | while read FILEs
do
	sudo cat /dev/null | sudo tee ${FILEs}
done

# reset juffed history
echo "# clear juffed history";
rm -vf ${HOME}/.config/juff/sessions/_empty_session_;
# reset to default content
#	cat > ${HOME}/.config/juff/sessions/_empty_session_ <<JUFFEDOUT
#	<!DOCTYPE JuffEd_Session>
#	<Session>
#	 <file cursorPos="2;14" scrollPos="0" panel="left" path="${HOME}/.config/juff/sessions/_empty_session_"/>
#	 <file cursorPos="0;0" scrollPos="0" panel="left" path="/10-Base/bin/update-live-image"/>
#	 <file cursorPos="0;0" scrollPos="0" panel="left" path="/10-Base/bin/make-live-image"/>
#	 <file cursorPos="54;11" scrollPos="38" panel="left" path="${HOME}/.config/lxqt/panel.conf"/>
#	 <view rightCurIndex="-1" leftCurIndex="3"/>
#	</Session>
#	JUFFEDOUT


# TODO: Add to cleanup
# /home/sak/.local/share/onlyoffice/desktopeditors/?
# /home/sak/.cache/?



echo "";
echo "================================================================================";
# echo "Clean up recent file list for Geany."
# read -p "Press enter to Open file. Close editor when done" CONFIRM_VAR;
# nano +205 ${HOME}/.config/geany/geany.conf;

#------------------------------------------------------------------------------#
# OPIONAL - clear APT cache
# removes everything but the lock file from /var/cache/apt/archives/
#                                       and /var/cache/apt/archives/partial/
# SUGGESTION: run '~/bin/f5-repo.sh' before running this
#             run seperately,
#                           , exit in f5-repo script will exit this script also
#------------------------------------------------------------------------------#
apt-get clean

#------------------------------------------------------------------------------#
echo "# ALL GIVEN WORK IS DONE, QUIT NOW"
exit 0
#------------------------------------------------------------------------------#
